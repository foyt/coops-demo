DiffXmlUtils={createClass:function(d,c){if((typeof c.init)!="function"){throw new Error("Class missing constructor")}if((typeof c.proto)!="object"){throw new Error("Class missing proto")}var b={};b.constructor={value:c.init,enumerable:false};for(var e in c.proto){b[e]={value:c.proto[e]}}var a=c.init;a.prototype=Object.create(d,b);return a},parseXmlDocument:function(a){if(window.DOMParser){var c=new DOMParser();return c.parseFromString(a,"text/xml")}else{var b=new ActiveXObject("Microsoft.XMLDOM");b.async=false;b.loadXML(a);return b}},serializeXmlDocument:function(a){var b=new XMLSerializer();return b.serializeToString(a)}};Delta=DiffXmlUtils.createClass(null,{init:function(){},proto:{insert:function(d,b,a,c){},deleteNode:function(a){},move:function(d,c,b,a){},update:function(b,a){}}});InternalDelta=DiffXmlUtils.createClass(Delta,{init:function(a){this._changes=a||new Array()},proto:{getChanges:function(){return this._changes},getMoved:function(){return this._getChangesByType("move")},getDeleted:function(){return this._getChangesByType("delete")},getInserted:function(){return this._getChangesByType("insert")},getUpdated:function(){return this._getChangesByType("update")},addAttrsToDelta:function(a,d){var c;if(a==null){c=0}else{c=a.length}for(var b=0;b<c;b++){this.insert(a.item(b),d,0,1)}},insert:function(e,c,b,d){if(c instanceof Node){c=NodeOps.getXPath(c)}var a={type:"insert",parent:c,nodeType:e.nodeType,value:e.nodeValue};if(e.nodeType!=Node.ATTRIBUTE_NODE){a.childNo=b}if(e.nodeType==Node.ATTRIBUTE_NODE||e.nodeType==Node.ELEMENT_NODE||e.nodeType==Node.PROCESSING_INSTRUCTION_NODE){a.nodeName=e.nodeName}if(d>1){a.charpos=d}this._changes.push(a);if(e.nodeType==Node.ELEMENT_NODE){this.addAttrsToDelta(e.attributes,c+"/node()["+b+"]")}},deleteNode:function(d){var a={type:"delete",node:NodeOps.getXPath(d)};if(d.nodeType==Node.TEXT_NODE){var c=new ChildNumber(d);var b=c.getXPathCharPos();if(b>=1){a.charpos=b;a.length=d.length}}this._changes.push(a)},move:function(e,d,c,a){if(a<1){throw new Error("New Character position must be >= 1")}if(d instanceof Node){d=NodeOps.getXPath(d)}var b={type:"move",node:NodeOps.getXPath(e),ocharpos:new ChildNumber(e).getXPathCharPos(),ncharpos:a,parent:d,childNo:c};if(e.nodeType==Node.TEXT_NODE){b.length=e.length}this._changes.push(b)},update:function(c,a){var b={type:"update",node:NodeOps.getXPath(c)};if(c.nodeType==Node.ELEMENT_NODE){b.nodeName=a.nodeName;this._updateAttributes(c,a)}else{b.nodeValue=a.nodeValue}this._changes.push(b)},toDUL:function(){var d=this.getChanges();var c=DiffXmlUtils.parseXmlDocument('<?xml version="1.0" encoding="UTF-8" standalone="no"?><delta/>');for(var b=0,a=d.length;b<a;b++){var e=d[b];switch(e.type){case"insert":this._appendInsertDULNode(c,e.parent,e.nodeType,e.childNo,e.nodeName,e.charpos,e.value);break;case"delete":this._appendDeleteDULNode(c,e.charpos,e.length,e.node);break;case"move":this._appendMoveDULNode(c,e.node,e.ocharpos,e.ncharpos,e.parent,e.childNo,e.length);break;case"update":this._appendUpdateDULNode(c,e.node,e.nodeName,e.nodeValue);break;default:throw new Error("Invalid operation: "+e.type);break}}return DiffXmlUtils.serializeXmlDocument(c)},_appendInsertDULNode:function(b,c,a,f,h,g,e){var d=b.createElement(DULConstants.INSERT);if(g){d.setAttribute(DULConstants.CHARPOS,g)}if(f){d.setAttribute(DULConstants.CHILDNO,f)}if(h){d.setAttribute(DULConstants.NAME,h)}if(a){d.setAttribute(DULConstants.NODETYPE,a)}if(c){d.setAttribute(DULConstants.PARENT,c)}if(e){d.appendChild(b.createTextNode(e))}b.documentElement.appendChild(d)},_appendDeleteDULNode:function(a,e,c,d){var b=a.createElement(DULConstants.DELETE);if(e){b.setAttribute(DULConstants.CHARPOS,e)}if(c){b.setAttribute(DULConstants.LENGTH,c)}if(d){b.setAttribute(DULConstants.NODE,d)}a.documentElement.appendChild(b)},_appendMoveDULNode:function(c,f,b,a,d,g,e){var f=c.createElement(DULConstants.MOVE);if(f){f.setAttribute(DULConstants.NODE,f)}if(b){f.setAttribute(DULConstants.OLD_CHARPOS,b)}if(a){f.setAttribute(DULConstants.NEW_CHARPOS,a)}if(d){f.setAttribute(DULConstants.PARENT,d)}if(g){f.setAttribute(DULConstants.CHILDNO,g)}if(e){f.setAttribute(DULConstants.LENGTH,e)}c.documentElement.appendChild(f)},_appendUpdateDULNode:function(b,c,d,a){var c=b.createElement(DULConstants.DELETE);if(c){c.setAttribute(DULConstants.NODE,c)}if(d){c.appendChild(b.createTextNode(d))}else{if(a){c.appendChild(b.createTextNode(a))}}b.documentElement.appendChild(c)},_updateAttributes:function(c,a){var e=c.attributes;var b=a.attributes;for(var g=0;g<e.length;g++){var h=e.item(g);var d=b[h.name];if(d==null){this.deleteNode(e.item(g))}else{if(h.nodeValue!=d.nodeValue){this.update(h,d)}}}for(var f=0;f<b.length;f++){var d=b.item(f);if(e[d.name]==null){this.insert(d,NodeOps.getXPath(c),0,1)}}},_getChangesByType:function(d){var a=new Array();for(var c=0,b=this._changes.length;c<b;c++){if(this._changes[c].type==d){a.push(this._changes[c])}}return a}}});InternalPatch=DiffXmlUtils.createClass(null,{init:function(){},proto:{apply:function(d,e){for(var c=0,a=e.getChanges().length;c<a;c++){d.normalize();var b=e.getChanges()[c];switch(b.type){case"insert":this._doInsert(d,b);break;case"delete":this._doDelete(d,b);break;case"move":this._doMove(d,b);break;case"update":this._doUpdate(d,b);break}}},_doInsert:function(i,c){var b=parseInt(c.charpos||1);var f=this._findNodeByXPath(i,c.parent);var h=f.childNodes;var e=c.nodeType;var j=c.value;var a=c.childNo===undefined?1:parseInt(c.childNo);var d=this._getDOMChildNo(e,h,a);var g=null;switch(e){case Node.TEXT_NODE:g=i.createTextNode(j);this._insertNode(h,f,d,b,g,i);break;case Node.CDATA_SECTION_NODE:g=i.createCDATASection(j);this._insertNode(h,f,d,b,g,i);break;case Node.ELEMENT_NODE:g=i.createElement(c.nodeName);this._insertNode(h,f,d,b,g,i);break;case Node.COMMENT_NODE:g=i.createComment(j);this._insertNode(h,f,d,b,g,i);break;case Node.ATTRIBUTE_NODE:if(f.nodeType!=Node.ELEMENT_NODE){throw new Error("Parent not an element")}f.setAttribute(c.nodeName,j);break;default:throw new Error("Unknown NodeType "+e)}},_doDelete:function(f,a){var b=this._findNodeByXPath(f,a.node);if(b.nodeType==Node.ATTRIBUTE_NODE){b.ownerElement.removeAttributeNode(b)}else{if(b.nodeType==Node.TEXT_NODE){var g=a.charpos===undefined?1:a.charpos;var c=a.length;if(c===undefined){this._deleteText2(b,g,f)}else{try{this._deleteText(b,g,c,f)}catch(d){this._deleteText2(b,g,f)}}}else{b.parentNode.removeChild(b)}}},_doUpdate:function(f,b){var e=this._findNodeByXPath(f,b.node);if(e.nodeType==Node.ELEMENT_NODE){var d=f.createElement(b.nodeName);for(var c=0,a=e.attributes.length;c<a;c++){d.attributes[e.attributes[c].name]=e.attributes[c].value}while(e.hasChildNodes()){d.appendChild(updateNode.firstChild)}e.parentNode.replaceChild(d,e)}else{e.nodeValue=b.nodeValue}},_doMove:function(k,d){var b=this._findNodeByXPath(k,d.node);var c=d.ocharpos;var f=d.ncharpos;if(b.nodeType==Node.TEXT_NODE){var l="";try{var a=d.length;if(a){l=this._deleteText(b,c,a,k)}else{l=this._deleteText2(b,c,k)}}catch(h){l=this._deleteText2(b,c,k)}b=k.createTextNode(l)}if(b.nodeType!=Node.TEXT_NODE){b=b.parentNode.removeChild(b)}var j=this._findNodeByXPath(k,d.parent);var g=j.childNodes;var i=this._getDOMChildNo(b.nodeType,g,d.childNo);this._insertNode(g,j,i,f,b,k)},_findNodeByXPath:function(b,c){var a=b.evaluate(c,b,null,XPathResult.ANY_TYPE,null);return a.iterateNext()},_getDOMChildNo:function(a,d,b){var c=0;if(a!=Node.ATTRIBUTE_NODE){c=this._getDOMChildNoFromXPath(d,b)}return c},_getDOMChildNoFromXPath:function(c,b){var a=0;var d=1;while((d<b)&&(a<c.length)){if(!((this._prevNodeIsATextNode(c,a))&&(c.item(a).nodeType==Node.TEXT_NODE))){d++}a++}if(d<b){a++;d++}return a},_prevNodeIsATextNode:function(b,a){return a>0&&b.item(a-1).nodeType==Node.TEXT_NODE},_insertAtCharPos:function(e,j,l,h,m,k){var i=e;var f=l-1;var d=false;while(this._prevNodeIsATextNode(j,f)){f--}while((j.item(f).nodeType==Node.TEXT_NODE)&&(i>j.item(f).length)){i=i-j.item(f).length;f++;if(f==j.length){if(i>1){throw new Error("charpos past end of text")}d=true;m.appendChild(h);break}}var g=j.item(f);if(!d){if(i==1){m.insertBefore(h,g)}else{if(i>g.length){var b=g.nextSibling;if(b!=null){m.insertBefore(h,b)}else{m.appendChild(h)}}else{var n=g.nodeValue;var b=g.nextSibling;m.removeChild(g);var c=k.createTextNode(n.substring(0,i-1));var a=k.createTextNode(n.substring(i-1));if(b!=null){m.insertBefore(c,b);m.insertBefore(h,b);m.insertBefore(a,b)}else{m.appendChild(c);m.appendChild(h);m.appendChild(a)}}}}},_insertNode:function(e,b,c,f,a,d){if(c>e.length){throw new Error("Child number past end of nodes")}if(b.nodeType!=Node.ELEMENT_NODE&&b.nodeType!=Node.DOCUMENT_NODE){throw new Error("Parent must be an element")}if((e.length>0)){if(this._prevNodeIsATextNode(e,c)){this._insertAtCharPos(f,e,c,a,b,d)}else{if(c<e.length){b.insertBefore(a,e.item(c))}else{b.appendChild(a)}}}else{b.appendChild(a)}},_deleteText:function(f,g,b,d){if(f.nodeType!=Node.TEXT_NODE){throw new Error("Attempt to delete text from non-text node.")}var e=f.nodeValue;if(g>e.length){throw new Error("charpos past end of text node.")}if((b+g-1)>e.length){throw new Error("length past end of text node.")}var c=e.substring(0,g-1)+e.substring(g-1+b);if(c.length>0){var a=d.createTextNode(c);f.parentNode.insertBefore(a,f)}f.parentNode.removeChild(f);return e.substring(g-1,g-1+b)},_deleteText2:function(c,d,b){var a=c.nodeValue.length-d+1;return this._deleteText(c,d,a,b)}}});EditScript=DiffXmlUtils.createClass(null,{init:function(c,b,a){this._document1=c;this._document2=b;this._matchings=a;this._delta=null},proto:{create:function(g){this._delta=g||new InternalDelta();var c=new NodeFifo();c.addChildrenOfNode(this._document2);var e=this._document2.documentElement;this._alignChildren(this._document1,this._document2,this._matchings);while(!c.isEmpty()){var a=c.pop();c.addChildrenOfNode(a);var f=a.parentNode;var d=this._matchings.getPartner(f);var b=this._matchings.getPartner(a);if(!this._matchings.isMatched(a)){b=this._doInsert(a,d)}else{if(NodeOps.checkIfSameNode(a,e)&&!Match.compareElements(b,a)){b=this._doUpdate(b,a)}else{if(!(this._matchings.getPartner(f)==b.parentNode)){this._doMove(b,a,d,this._matchings)}}}this._alignChildren(b,a,this._matchings)}this._deletePhase(this._document1,this._matchings);return this._delta},_doUpdate:function(b,a){var e=b.ownerDocument;var f=null;if(b.nodeType==Node.ELEMENT_NODE){this._delta.update(b,a);f=e.createElement(a.nodeName);var c=a.attributes;for(var d=0;d<c.length;d++){f.attributes[c[d].name]=c[d].value}while(b.hasChildNodes()){f.appendChild(b.firstChild)}b.parentNode.replaceChild(f,b);this._matchings.remove(b);this._matchings.add(f,a)}return f},_doInsert:function(a,c){var d=new FindPosition(a,this._matchings);var b=a.cloneNode(false);NodeOps.setInOrder(b);NodeOps.setInOrder(a);this._delta.insert(b,c,d.getXPathInsertPosition(),d.getCharInsertPosition());b=this._insertAsChild(d.getDOMInsertPosition(),c,b);this._matchings.add(b,a);return b},_doMove:function(c,b,f,e){var d=c.parentNode;var h=b.parentNode;var a=e.getPartner(h);if(NodeOps.checkIfSameNode(d,a)){throw new Error("v is same as partnerY")}var g=new FindPosition(b,e);NodeOps.setInOrder(c);NodeOps.setInOrder(b);this._delta.move(c,f,g.getXPathInsertPosition(),g.getCharInsertPosition());this._insertAsChild(g.getDOMInsertPosition(),f,c)},_deletePhase:function(d,a){var b=d.childNodes;if(b!=null){for(var c=(b.length-1);c>=0;c--){this._deletePhase(b.item(c),a)}}if(!a.isMatched(d)&&d.nodeType!=Node.DOCUMENT_TYPE_NODE){this._delta.deleteNode(d);d.parentNode.removeChild(d)}},_markChildrenOutOfOrder:function(c){for(var b=0,a=c.childNodes.length;b<a;b++){NodeOps.setOutOfOrder(c.childNodes.item(b))}},_markChildrenInOrder:function(c){for(var b=0,a=c.childNodes.length;b<a;b++){NodeOps.setInOrder(c.childNodes.item(b))}},_setNodesInOrder:function(c,b){for(var d=0,a=c.length;d<a;d++){var e=c[d];NodeOps.setInOrder(e);NodeOps.setInOrder(b.getPartner(e))}},_moveMisalignedNodes:function(j,k,d,g){for(var e=0,c=k.length;e<c;e++){var i=k[e];if(NodeOps.getNodeIndex(d,i)==-1){var h=g.getPartner(i);var f=new FindPosition(h,g);this._delta.move(i,j,f.getXPathInsertPosition(),f.getCharInsertPosition());this._insertAsChild(f.getDOMInsertPosition(),j,i);NodeOps.setInOrder(i);NodeOps.setInOrder(h)}}},_alignChildren:function(c,a,d){this._markChildrenOutOfOrder(c);this._markChildrenOutOfOrder(a);var h=c.childNodes;var f=a.childNodes;var e=NodeSequence.getSequence(h,f,d);var b=NodeSequence.getSequence(f,h,d);var g=NodeSequence.getLCS(e,b,d);this._setNodesInOrder(g,d);this._moveMisalignedNodes(c,e,g,d);this._markChildrenInOrder(c);this._markChildrenInOrder(a)},_insertAsChild:function(c,b,a){if(a.parentNode){a.parentNode.removeChild(a)}var d=b.childNodes.item(c);if(d){b.insertBefore(a,d)}else{b.appendChild(a)}return a}}});FindPosition=DiffXmlUtils.createClass(null,{init:function(a,c){this._insertPositionDOM=null;this._insertPositionXPath=null;this._charInsertPosition=null;var b=this._getInOrderLeftSibling(a);if(b==null){this._insertPositionDOM=0;this._insertPositionXPath=1;this._charInsertPosition=1}else{var d=c.getPartner(b);var e=new ChildNumber(d);this._insertPositionDOM=e.getInOrderDOM()+1;this._insertPositionXPath=e.getInOrderXPath()+1;if(d.nodeType==Node.TEXT_NODE){this._charInsertPosition=e.getInOrderXPathCharPos()+d.length}else{this._charInsertPosition=1}}},proto:{_getInOrderLeftSibling:function(b){var a=b.previousSibling;while(a!=null&&!NodeOps.isInOrder(a)){a=a.previousSibling}return a},getDOMInsertPosition:function(){return this._insertPositionDOM},getXPathInsertPosition:function(){return this._insertPositionXPath},getCharInsertPosition:function(){return this._charInsertPosition}}});Fmes=DiffXmlUtils.createClass(null,{init:function(){},proto:{diff:function(c,b,d){var a=Match.easyMatch(c,b);return(new EditScript(c,b,a)).create(d)}}});NodeFifo=DiffXmlUtils.createClass(null,{init:function(){this._fifo=new Array()},proto:{push:function(a){this._fifo.push(a)},isEmpty:function(){return this._fifo.length==0},pop:function(){if(this.isEmpty()){return null}return this._fifo.shift()},addChildrenOfNode:function(a){var c=a.childNodes;if(c!=null){for(var d=0,b=c.length;d<b;d++){if((c.item(d).nodeType==Node.DOCUMENT_TYPE_NODE)){continue}this.push(c.item(d))}}}}});NodeOps={setUserData:function(b,a,c){if(!b._userData){b._userData={}}b._userData[a]=c},getUserData:function(b,a){if(b._userData){return b._userData[a]}return null},getNodeIndex:function(d,c){if(d instanceof Array){return d.indexOf(c)}else{if(d instanceof NodeList){for(var b=0,a=d.length;b<a;b++){if(d.item(b)==c){return b}}}}return -1},setInOrder:function(a){NodeOps.setUserData(a,"inorder",true)},setOutOfOrder:function(a){NodeOps.setUserData(a,"inorder",false)},isInOrder:function(b){var a=NodeOps.getUserData(b,"inorder");return a==null?true:a},checkIfSameNode:function(a,b){if(a!=null&&b!=null){return a==b}return false},getXPath:function(c){var a;if(c.nodeType==Node.ATTRIBUTE_NODE){a=this.getXPath(c.ownerElement)+"/@"+c.nodeName}else{if(c.nodeType==Node.DOCUMENT_NODE){a="/"}else{if(c.nodeType==Node.DOCUMENT_TYPE_NODE){throw new Error("DocumentType nodes cannot be identified with XPath")}else{if(c.parentNode.nodeType==Node.DOCUMENT_NODE){var b=new ChildNumber(c);a="/node()["+b.getXPath()+"]"}else{var b=new ChildNumber(c);a=this.getXPath(c.parentNode)+"/node()["+b.getXPath()+"]"}}}}return a},nodeIsEmptyText:function(a){if(a.nodeType=Node.TEXT_NODE){return a.length==0}return false}};NodePairs=DiffXmlUtils.createClass(null,{init:function(){this._pairs=new Object();this._pairCount=0;this._hashCounter=new Date().getTime()},proto:{add:function(a,d){var c=++this._hashCounter;var b=++this._hashCounter;this._pairs[c]=d;this._pairs[b]=a;this._pairCount+=2;NodeOps.setUserData(a,"hash",c);NodeOps.setUserData(d,"hash",b);this._setMatched(a,d)},_setMatchedNode:function(a){NodeOps.setUserData(a,"matched",true)},isMatched:function(b){var a=NodeOps.getUserData(b,"matched");return a==null?false:a},_setMatched:function(b,a){this._setMatchedNode(b);this._setMatchedNode(a)},getPartner:function(b){if(b==null){return null}else{var a=NodeOps.getUserData(b,"hash");return a?this._pairs[a]||null:null}},size:function(){return this._pairCount},remove:function(c){var b=NodeOps.getUserData(c,"hash");var a=this._pairs[b];NodeOps.setUserData(a,"matched",null);NodeOps.setUserData(c,"matched",null);delete this._pairs[NodeOps.getUserData(a,"hash")];delete this._pairs[b];this._pairCount-=2}}});NodeDepth=DiffXmlUtils.createClass(null,{init:function(a){this._node=a;this._depth=this._calculateDepth(this._node)},proto:{getDepth:function(){return this._depth},getNode:function(){return this._node},_calculateDepth:function(b){var d=0;var a=b;var c;if(b.nodeType==Node.DOCUMENT_NODE){c=b}else{c=a.ownerDocument}while(a!=c){d++;a=a.parentNode}return d}}});Match={easyMatch:function(g,e){var n=new NodePairs();g.documentElement.normalize();e.documentElement.normalize();var m=this._initialiseAndOrderNodes(g);var k=this._initialiseAndOrderNodes(e);n.add(g,e);n.add(g.documentElement,e.documentElement);for(var d=0,a=m.length;d<a;d++){var p=m[d];var h=p.getNode();for(var b=0,c=k.length;b<c;b++){var o=k[b];var f=o.getNode();if(this._compareNodes(h,f)){n.add(h,f);this._removeItemFromNodeDepth(k,o);break}}}return n},compareElements:function(l,j){var g=false;if(l.nodeName==j.nodeName){g=true;var e=l.attributes;var h=j.attributes;var c=0;if(e!=null){c=e.length}var f=0;if(h!=null){f=h.length}if(c!=f){g=false}var d=0;while(g&&(d<c)){var k=h[e.item(d).nodeName];if(k==null||(k.value!=e.item(d).value)){g=false}d++}}return g},compareTextNodes:function(e,c){var d=e.data;var f=c.data;return d==f},_compareNodes:function(d,c){var e=false;if(d.nodeType==c.nodeType){switch(d.nodeType){case Node.ELEMENT_NODE:e=this.compareElements(d,c);break;case Node.TEXT_NODE:e=this.compareTextNodes(d,c);break;case Node.DOCUMENT_NODE:e=true;break;default:e=d.nodeValue==c.nodeValue;break}}return e},_initialiseAndOrderNodes:function(c){var a=c.createNodeIterator(c,NodeFilter.SHOW_ALL,null);var b=new Array();var d;while((d=a.nextNode())!=null){if(!(NodeOps.checkIfSameNode(c,d)||NodeOps.checkIfSameNode(c.documentElement,d)||d.nodeType==Node.DOCUMENT_TYPE_NODE)){b.push(new NodeDepth(d))}}a.detach();b.sort(function(f,e){return e.getDepth()-f.getDepth()});return b},_removeItemFromNodeDepth:function(c,b){var a=c.indexOf(b);if(a!=-1){c.splice(a,1)}}};NodeSequence={getSequence:function(g,e,c){var b=null;if(g!=null&&e!=null){var f=new Array();var h=new Array();for(var d=0,a=e.length;d<a;d++){h.push(e.item(d))}for(var d=0,a=g.length;d<a;d++){if(h.indexOf(c.getPartner(g.item(d)))!=-1){f.push(g.item(d))}}b=f}return b},getLCS:function(p,n,m){var g=new Array();for(var f=0,b=p.length+1;f<b;f++){var c=new Array();for(var d=0,e=n.length+1;d<e;d++){c.push(0)}g.push(c)}for(var f=1;f<=p.length;f++){for(var d=1;d<=n.length;d++){var k=m.getPartner(p[f-1]);var h=n[d-1];if(NodeOps.checkIfSameNode(k,h)){g[f][d]=1+g[f-1][d-1]}else{g[f][d]=Math.max(g[f-1][d],g[f][d-1])}}}var o=p.length;var a=n.length;var q=new Array();while(o!=0&&a!=0){if(NodeOps.checkIfSameNode(m.getPartner(p[o-1]),n[a-1])){q.unshift(p[o-1]);o--;a--}else{if(g[o][a-1]>=g[o-1][a]){a--}else{o--}}}return q}};ChildNumber=DiffXmlUtils.createClass(null,{init:function(a){if(a==null){throw new Error("Node cannot be null")}if(a.parentNode==null){throw new Error("Node must have parent")}this._domChildNo=-1;this._xPathChildNo=-1;this._xPathCharPos=-1;this._inOrderDOMChildNo=-1;this._inOrderXPathChildNo=-1;this._inOrderXPathCharPos=-1;this._node=a;this._siblings=this._node.parentNode.childNodes},proto:{getDOM:function(){if(this._domChildNo==-1){this._calculateDOMChildNumber()}return this._domChildNo},getXPathCharPos:function(){if(this._xPathCharPos==-1){this._calculateXPathChildNumberAndPosition()}return this._xPathCharPos},getInOrderXPathCharPos:function(){if(this._inOrderXPathCharPos==-1){this._calculateInOrderXPathChildNumberAndPosition()}return this._inOrderXPathCharPos},getXPath:function(){if(this._xPathChildNo==-1){this._calculateXPathChildNumberAndPosition()}return this._xPathChildNo},getInOrderXPath:function(){if(this._inOrderXPathChildNo==-1){this._calculateInOrderXPathChildNumberAndPosition()}return this._inOrderXPathChildNo},getInOrderDOM:function(){if(this._inOrderXPathChildNo==-1){this._calculateInOrderDOMChildNumber()}return this._inOrderDOMChildNo},_incIndex:function(a){var c=true;var b=this._siblings.item(a);if((a>0&&this._nodesAreTextNodes([b,this._siblings.item(a-1)]))||NodeOps.nodeIsEmptyText(b)){c=false}return c},_nodesAreTextNodes:function(b){var d=true;for(var c=0,a=b.length;c<a;c++){var e=b[c];if((e==null)||(e.nodeType!=Node.TEXT_NODE)){d=false;break}}return d},_calculateDOMChildNumber:function(){var a;for(a=0;a<this._siblings.length;a++){if(NodeOps.checkIfSameNode(this._siblings.item(a),this._node)){break}}this._domChildNo=a},_calculateInOrderDOMChildNumber:function(){this._inOrderDOMChildNo=0;for(var a=0;a<this._siblings.length;a++){if(NodeOps.checkIfSameNode(this._siblings.item(a),this._node)){break}if(NodeOps.isInOrder(this._siblings.item(a))){this._inOrderDOMChildNo++}}},_calculateXPathChildNumberAndPosition:function(){var a=this._calculateXPathChildNumber();this._calculateXPathTextPosition(a)},_calculateInOrderXPathChildNumberAndPosition:function(){var a=this._calculateInOrderXPathChildNumber();this._calculateInOrderXPathTextPosition(a)},_calculateXPathTextPosition:function(a){this._xPathCharPos=1;for(var b=(a-1);b>=0;b--){if(this._siblings.item(b).nodeType==Node.TEXT_NODE){this._xPathCharPos=this._xPathCharPos+this._siblings.item(b).length}else{break}}},_calculateXPathChildNumber:function(){var b=1;var a;for(a=0;a<this._siblings.length;a++){if(NodeOps.checkIfSameNode(this._siblings.item(a),this._node)){if(!this._incIndex(a)){b--}break}if(this._incIndex(a)){b++}}this._xPathChildNo=b;return a},_calculateInOrderXPathChildNumber:function(){var c=0;var b;var d=null;var a=null;for(b=0;b<this._siblings.length;b++){a=this._siblings.item(b);if(NodeOps.isInOrder(a)&&!(this._nodesAreTextNodes([a,d])||NodeOps.nodeIsEmptyText(a))){c++}if(NodeOps.checkIfSameNode(a,this._node)){break}if(NodeOps.isInOrder(a)){d=a}}if(a!=null&&!NodeOps.isInOrder(a)){c++}this._inOrderXPathChildNo=c;return b},_calculateInOrderXPathTextPosition:function(a){this._inOrderXPathCharPos=1;for(var b=(a-1);b>=0;b--){if(this._siblings.item(b).nodeType==Node.TEXT_NODE){if(NodeOps.isInOrder(this._siblings.item(b))){this._inOrderXPathCharPos=this._inOrderXPathCharPos+this._siblings.item(b).length}}else{if(NodeOps.isInOrder(this._siblings.item(b))){break}}}}}});DULConstants={REVERSE_PATCH:"reverse_patch",PARENT_SIBLING_CONTEXT:"par_sib_context",PARENT_CONTEXT:"par_context",SIBLING_CONTEXT:"sib_context",DELTA:"delta",NEW_CHARPOS:"new_charpos",OLD_CHARPOS:"old_charpos",MOVE:"move",LENGTH:"length",NODE:"node",DELETE:"delete",CHARPOS:"charpos",NAME:"name",CHILDNO:"childno",NODETYPE:"nodetype",PARENT:"parent",INSERT:"insert",UPDATE:"update",RESOLVE_ENTITIES:"resolve_entities",FALSE:"false",TRUE:"true"};DULParser={parseDULPatch:function(d){var e=d.documentElement;if(e.nodeName!=DULConstants.DELTA){throw new Error("All deltas must begin with a "+DULConstants.DELTA+" element.")}var g=new Array();for(var c=0,a=e.childNodes.length;c<a;c++){var b=e.childNodes[c];switch(b.nodeName){case DULConstants.INSERT:g.push(this._parseInsert(b));break;case DULConstants.DELETE:g.push(this._parseDelete(b));break;case DULConstants.MOVE:g.push(this._parseMove(b));break;case DULConstants.UPDATE:g.push(this._parseUpdate(b));break}}var f=new InternalDelta(g);return f},_parseInsert:function(c){var d=c.getAttribute(DULConstants.PARENT);var b=parseInt(c.getAttribute(DULConstants.NODETYPE));var f={type:"insert",parent:d,nodeType:b};if(b!=Node.ATTRIBUTE_NODE){f.childNo=c.getAttribute(DULConstants.CHILDNO)}if((b==Node.ATTRIBUTE_NODE)||(b==Node.ELEMENT_NODE)||(b==Node.PROCESSING_INSTRUCTION_NODE)){f.nodeName=c.getAttribute(DULConstants.NAME)}var e=c.attributes[DULConstants.CHARPOS];if(e){f.charpos=e.value}var a=c.firstChild;if(a){f.value=a.nodeValue}return f},_parseDelete:function(a){var d={type:"delete",node:a.getAttribute(DULConstants.NODE)};var c=a.getAttribute(DULConstants.CHARPOS);var b=a.getAttribute(DULConstants.LENGTH);if(c!==null){d.charpos=parseInt(c)}if(b!==null){d.length=parseInt(b)}return d},_parseMove:function(a){var c={type:"move",node:a.getAttribute(DULConstants.NODE),ocharpos:parseInt(a.getAttribute(DULConstants.OLD_CHARPOS)),ncharpos:parseInt(a.getAttribute(DULConstants.NEW_CHARPOS)),parent:a.getAttribute(DULConstants.PARENT),childNo:parseInt(a.getAttribute(DULConstants.CHILDNO))};var b=a.getAttribute(DULConstants.LENGTH);if(b!==null){c.length=parseInt(b)}return c},_parseUpdate:function(a){var b={type:"update",node:a.getAttribute(DULConstants.NODE)};b.nodeName=b.nodeValue=a.firstChild.nodeValue;return b}};